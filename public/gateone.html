<!DOCTYPE html>
<html lang="en">
<head>
  <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <title>Pentium WebSSH</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="/gateone.js"></script>
  <script>

    GateOne.Base.superSandbox("GateOne.Terminal.Input", ["GateOne.Terminal", "GateOne.User", "GateOne.Input"], function(window, undefined) {
      "use strict";
      GateOne.Events.on("pentium-gateone-trigger", function (con, arg) {
        if (arg[0].match("Gate One server round-trip")) {
          connect()
          $('#loading-bar').hide();
        }
        if (arg[0].match("61.216.74.14")) {
          log();
        }

      });
    })

    window.onload = function () {
      var params = urlParams();
      var titleExist = 'title' in params;
      var titleFix = ' - Pentium WebSSH';

      //document.title = titleExist ? params.title.concat(titleFix) : decodeURIComponent(params.ssh).split('@')[1].concat(titleFix);     
      // return;
      GateOne.init({
        url: 'https://term.pentium.network',
        embedded: true,
        style: {'background-color': 'black'}
      });
    }

    function urlParams() {
      try {
        var search = location.search.substring(1);
        var params = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"') + '"}');
  
        return params;
      } catch (error) {
        return {};
      }        
    }

    /**
     * Terminal connection
     */  
    function connect() {
      GateOne.SSH.connect('ssh://root@61.216.74.14:45003');
    }

    /**
     * Log
     */
    function log() {
      $('#loading-bar').hide();
      console.log(GateOne.Terminal.terminals[1].created.getTime());
    } 
  </script>
  <style>
    #loading-bar {
      color: white;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;
    }
    #loading-bar .bar{
      position: absolute;
      text-align: center;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
<div id="loading-bar">
  <div class="bar">
    <span>读取中...</span><br>
    <img src="/icon/loading-icon.svg" width="30">
  </div>
</div>
<div id="gateone_container" style="position: fixed;top: 0; left: 0; width: 100%; height: 100%;">
  <div id="gateone"></div>
</div>
</body>
</html>
